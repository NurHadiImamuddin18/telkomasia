<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Change DW & FAT System</title>
  <style>
    /* Styling dasar body */
    body { font-family: Arial, sans-serif; margin: 0; background: #f5f7fa; }
    
    /* Styling untuk halaman (page) - default hidden */
    .page { display: none; padding: 40px; }
    .active { display: block; } /* Menampilkan halaman yang aktif */
    
    /* Card container untuk konten */
    .card { background: white; border-radius: 10px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); max-width: 900px; margin: auto; }
    
    /* Heading dengan warna brand */
    h1, h2 { color: #e20a0a; }
    
    /* Styling input dan select form */
    input, select { padding: 8px; margin: 5px 0 10px 0; border: 1px solid #ddd; border-radius: 6px; width: 100%; box-sizing: border-box; }
    
    /* Styling button utama */
    button { background: #ff5b10; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; }
    button:disabled { background: #ccc; cursor: not-allowed; } /* Button disabled state */
    
    /* Sidebar menu navigasi */
    .sidebar { position: fixed; top: 0; left: 0; width: 220px; height: 100%; background: #fff; border-right: 1px solid #ddd; padding: 20px; display: none; }
    .sidebar.active { display: block; }
    
    /* Content area dengan margin untuk sidebar */
    .content { margin-left: 240px; padding: 20px; }
    
    /* Button menu di sidebar */
    .menu-btn { display: block; margin-bottom: 10px; background: #f5f7fa; color: #1a3d7c; border: 1px solid #ccc; width: 100%; text-align: left; }
    
    /* Styling tabel */
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 10px; text-align: left; }
    
    /* Container untuk action buttons di tabel */
    .actions button { margin-right: 5px; margin-bottom: 5px; }
    
    /* Row untuk input material dengan flexbox */
    .material-row { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
    .material-row select { flex: 3; }
    .material-row input { flex: 2; }
    .material-row button { background: red; flex-shrink: 0; padding: 8px 12px; } /* Button hapus material */
    
    /* Container untuk foto berpasangan (Before/After) */
    .foto-pair { display: flex; justify-content: space-between; gap: 20px; }
    .foto-section { flex: 1; }
    .foto-section h3 { margin-bottom: 5px; }
    
    /* Slot untuk upload foto individual */
    .foto-slot { margin-bottom: 10px; }
    .foto-slot img { width: 150px; height: 100px; object-fit: cover; border: 1px solid #ccc; border-radius: 6px; margin-top: 5px; }
    
    /* Grid untuk menampilkan banyak foto */
    .foto-grid { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; align-items: flex-start; padding: 6px 0; }
    .foto-item { display: flex; flex-direction: column; align-items: center; width: calc(20% - 10px); box-sizing: border-box; min-width: 120px; }
    .foto-item img { width: 100%; height: 100px; object-fit: cover; border: 1px solid #ccc; border-radius: 6px; cursor: pointer; }
    .foto-item small { margin-top: 6px; text-align: center; display: block; word-break: break-word; }
    
    /* Preview foto yang diupload */
    .preview { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px; }
    .preview-item { display: flex; flex-direction: column; align-items: center; width: 160px; }
    .preview img { width: 160px; height: 100px; object-fit: cover; border: 1px solid #ccc; border-radius: 6px; margin-bottom: 5px; }
    .preview input { width: 100%; font-size: 12px; padding: 2px; text-align: center; }
    
    /* Modal overlay untuk popup */
    .modal { display: none; position: fixed; z-index: 10; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); align-items: center; justify-content: center; }
    .modal-content { background: #fff; padding: 24px; border-radius: 8px; max-width: 90vw; width: 900px; box-sizing: border-box; max-height: 90vh; overflow-y: auto; position: relative; }
    .close { position: absolute; top: 10px; right: 15px; cursor: pointer; font-size: 20px; }
    
    /* Modal khusus untuk preview gambar fullscreen */
    #imagePreviewModal { background: rgba(0,0,0,0.85); z-index: 20; display: none; align-items: center; justify-content: center; position: fixed; top: 0; left: 0; width: 100%; height: 100%; }
    #imagePreviewModal img { max-width: 90vw; max-height: 90vh; object-fit: contain; }
    #imagePreviewModal .close { color: #fff; font-size: 40px; top: 20px; right: 35px; position: absolute; cursor: pointer; }
    
    /* Info user yang sedang login */
    .user-info { padding: 10px; background: #f0f0f0; border-radius: 6px; margin-bottom: 10px; font-size: 14px; }
    
    /* Loading indicator */
    .loading { display: none; text-align: center; padding: 10px; color: #666; }
    .loading.active { display: block; }
    
    /* Notice untuk user read-only */
    .readonly-notice { background: #fff3cd; border: 1px solid #ffc107; padding: 10px; border-radius: 6px; margin-bottom: 15px; color: #856404; }
    
    /* Responsive design untuk mobile */
    @media (max-width: 700px) {
      .foto-item { width: calc(50% - 10px); min-width: 0; }
      .modal-content { width: 95vw; padding: 16px; }
      .content { margin-left: 0; }
      .sidebar { width: 100%; position: relative; }
    }
  </style>
</head>
<body>

  <!-- Halaman Login -->
  <div id="loginPage" class="page active">
    <div class="card">
      <h1>Login</h1>
      <p>Silakan login untuk masuk ke sistem Change DW & FAT</p>
      <label>Username</label>
      <input type="text" id="loginUsername" placeholder="Masukkan username" />
      <label>Password</label>
      <!-- Input password dengan enter key handler -->
      <input type="password" id="loginPassword" placeholder="Masukkan password" onkeypress="if(event.key==='Enter') login()" />
      <p id="loginError" style="color: red; display: none;">Username atau password salah!</p>
      <button onclick="login()">Login</button>
      <div class="loading" id="loginLoading">Memproses...</div>
    </div>
  </div>

  <!-- Halaman Utama (setelah login) -->
  <div id="mainPage" class="page">
    <!-- Sidebar Menu -->
    <div class="sidebar active" id="sidebar">
      <h3>Menu</h3>
      <!-- Info user yang sedang login -->
      <div class="user-info">
        <strong>User:</strong><br>
        <span id="currentUser"></span><br>
        <small id="userRole"></small>
      </div>
      <!-- Menu navigasi -->
      <button class="menu-btn" onclick="openForm('DW')" id="btnChangeDW">Change DW</button>
      <button class="menu-btn" onclick="openForm('FAT')" id="btnChangeFAT">Change FAT</button>
      <button class="menu-btn" onclick="showResume()">Resume</button>
      <!-- Button tambah akun (hanya untuk admin) -->
      <button class="menu-btn" onclick="showAddAccount()" id="addAccountBtn" style="display:none;">Tambah Akun</button>
      <button class="menu-btn" onclick="logout()" style="background: #dc3545; color: white; margin-top: 20px;">Logout</button>
    </div>
    
    <!-- Content Area -->
    <div class="content">
      <div id="formPage" class="card" style="display:none;"></div>
      <div id="resumePage" class="card" style="display:none;"></div>
      <div id="addAccountPage" class="card" style="display:none;"></div>
    </div>
  </div>

  <!-- Modal untuk detail order -->
  <div id="modal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal()">&times;</span>
      <div id="modalBody"></div>
    </div>
  </div>

  <!-- Modal untuk preview gambar fullscreen -->
  <div id="imagePreviewModal" onclick="closeImagePreview()">
    <span class="close" onclick="event.stopPropagation(); closeImagePreview();">&times;</span>
    <img id="fullSizeImage" onclick="event.stopPropagation();">
  </div>

  <script>
    // ==================== KONFIGURASI & VARIABEL GLOBAL ====================
    
    // Base URL untuk API endpoint
    const API_URL = '/api';
    
    // Variabel untuk menyimpan tipe form yang sedang aktif (DW/FAT)
    let currentType = "";
    
    // Array untuk menyimpan data resume orders
    let resumeData = [];
    
    // Array untuk menyimpan file yang dipilih user (untuk upload)
    let selectedFiles = [];
    
    // Object untuk menyimpan foto-foto FAT (10 foto: before/after/proses)
    let fatPhotos = {};
    
    // Object untuk menyimpan informasi user yang sedang login
    let currentUser = null;

    // ==================== HELPER FUNCTIONS ====================
    
    // Fungsi untuk mendapatkan headers dengan role user untuk authorization
    function getAuthHeaders() {
      const headers = {
        'Content-Type': 'application/json'
      };
      
      // Tambahkan role user ke header jika ada
      if (currentUser && currentUser.role) {
        headers['X-User-Role'] = currentUser.role;
      }
      
      return headers;
    }

    // Fungsi untuk mengecek apakah user adalah admin
    function isAdmin() {
      return currentUser && currentUser.role === 'admin';
    }

    // Fungsi untuk mendapatkan opsi material berdasarkan tipe (DW/FAT)
    function getMaterialOptions(type) {
        if (type === "DW") {
            // Material untuk DW (Dropwire)
            return `<option value="SN ONT Lama">SN ONT Lama</option><option value="SN ONT Baru">SN ONT Baru</option><option value="Kabel Precon">Kabel Precon</option><option value="ONT">ONT</option><option value="Paku Clamp">Paku Clamp</option><option value="Cable Ties">Cable Ties</option><option value="Label ID">Label ID</option><option value="Precon">Precon</option>`;
        } else {
            // Material untuk FAT (Fiber Access Terminal)
            return `<option value="Box">Box</option><option value="Pigtail">Pigtail</option><option value="Protektor">Protektor</option><option value="Barel">Barel</option><option value="Isolasi">Isolasi</option><option value="Ties">Ties</option><option value="Kabel DW">Kabel DW</option><option value="Spliter">Spliter</option>`;
        }
    }

    // ==================== AUTHENTICATION ====================
    
    // Fungsi untuk login
    async function login() {
      // Ambil value dari input
      const username = document.getElementById('loginUsername').value;
      const password = document.getElementById('loginPassword').value;
      const loading = document.getElementById('loginLoading');
      const errorMsg = document.getElementById('loginError');
      
      // Validasi input tidak boleh kosong
      if (!username || !password) {
        errorMsg.innerText = 'Username dan password harus diisi!';
        errorMsg.style.display = 'block';
        return;
      }
      
      // Tampilkan loading indicator
      loading.classList.add('active');
      errorMsg.style.display = 'none';
      
      try {
        // Kirim request login ke API
        const response = await fetch(`${API_URL}/login`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username, password })
        });
        
        const data = await response.json();
        loading.classList.remove('active');
        
        if (data.success) {
          // Login berhasil
          currentUser = data.user;
          
          // Pindah ke halaman utama
          document.getElementById('loginPage').classList.remove('active');
          document.getElementById('mainPage').classList.add('active');
          
          // Tampilkan info user
          document.getElementById('currentUser').innerText = currentUser.username;
          document.getElementById('userRole').innerText = currentUser.role === 'admin' ? '(Administrator)' : '(User - View Only)';
          
          // Tampilkan menu sesuai role
          if (isAdmin()) {
            // Admin dapat akses semua menu
            document.getElementById('addAccountBtn').style.display = 'block';
            document.getElementById('btnChangeDW').style.display = 'block';
            document.getElementById('btnChangeFAT').style.display = 'block';
          } else {
            // User biasa hanya bisa view
            document.getElementById('addAccountBtn').style.display = 'none';
            document.getElementById('btnChangeDW').style.display = 'none';
            document.getElementById('btnChangeFAT').style.display = 'none';
          }
          
          // Load data orders dan tampilkan resume
          await loadOrders();
          showResume();
        } else {
          // Login gagal
          errorMsg.innerText = 'Username atau password salah!';
          errorMsg.style.display = 'block';
        }
      } catch (error) {
        // Error handling
        loading.classList.remove('active');
        errorMsg.innerText = 'Error: ' + error.message;
        errorMsg.style.display = 'block';
      }
    }

    // Fungsi untuk logout
    function logout() {
      if (confirm('Apakah Anda yakin ingin logout?')) {
        // Reset semua data
        currentUser = null;
        resumeData = [];
        
        // Kembali ke halaman login
        document.getElementById('mainPage').classList.remove('active');
        document.getElementById('loginPage').classList.add('active');
        
        // Clear input login
        document.getElementById('loginUsername').value = '';
        document.getElementById('loginPassword').value = '';
        document.getElementById('loginError').style.display = 'none';
        document.getElementById('addAccountBtn').style.display = 'none';
      }
    }

    // ==================== DATA MANAGEMENT ====================
    
    // Fungsi untuk load semua orders dari database
    async function loadOrders() {
      try {
        const response = await fetch(`${API_URL}/orders`);
        const data = await response.json();
        if (data.success) {
          resumeData = data.orders;
        } else {
          resumeData = [];
        }
      } catch (error) {
        console.error('Error loading orders:', error);
        resumeData = [];
      }
    }

    // ==================== FORM MANAGEMENT ====================
    
    // Fungsi untuk membuka form input (DW atau FAT)
    function openForm(type) {
      // Cek authorization - hanya admin yang bisa input
      if (!isAdmin()) {
        alert('Akses ditolak! Hanya Admin yang dapat mengisi form.');
        return;
      }
      
      currentType = type;
      
      // Tampilkan form page, sembunyikan yang lain
      document.getElementById('formPage').style.display = "block";
      document.getElementById('resumePage').style.display = "none";
      document.getElementById('addAccountPage').style.display = "none";
      
      const materialOptions = getMaterialOptions(type);
      
      // Reset data
      selectedFiles = [];
      fatPhotos = {};

      if (type === "FAT") {
        // ===== FORM FAT =====
        // FAT memiliki 10 foto khusus (before/after/proses untuk berbagai kategori)
        document.getElementById('formPage').innerHTML = `<h2>${type} → Input Data</h2><label>FAT Name</label><input type="text" id="FATName" placeholder="Masukkan FAT Name" /><label>Nama Teknisi</label><input type="text" id="namaTeknisi" placeholder="Nama teknisi" /><div id="materialContainer"><label>Material</label><div class="material-row"><select>${materialOptions}</select><input type="text" placeholder="Qty / Keterangan" /><button onclick="removeMaterial(this)">x</button></div></div><button type="button" onclick="addMaterial()">+ Tambah Material</button><hr style="margin: 20px 0;"><div class="foto-pair"><div class="foto-section"><h3>Redaman In</h3><div class="foto-slot">Before: <input type="file" onchange="handleFatPhoto(event,'redamanInBefore')" accept="image/*"><div id="prev-redamanInBefore"></div></div><div class="foto-slot">After: <input type="file" onchange="handleFatPhoto(event,'redamanInAfter')" accept="image/*"><div id="prev-redamanInAfter"></div></div></div><div class="foto-section"><h3>Redaman Out</h3><div class="foto-slot">Before: <input type="file" onchange="handleFatPhoto(event,'redamanOutBefore')" accept="image/*"><div id="prev-redamanOutBefore"></div></div><div class="foto-slot">After: <input type="file" onchange="handleFatPhoto(event,'redamanOutAfter')" accept="image/*"><div id="prev-redamanOutAfter"></div></div></div></div><div class="foto-pair"><div class="foto-section"><h3>Tampak Depan FAT</h3><div class="foto-slot">Before: <input type="file" onchange="handleFatPhoto(event,'depanBefore')" accept="image/*"><div id="prev-depanBefore"></div></div><div class="foto-slot">Proses: <input type="file" onchange="handleFatPhoto(event,'depanProses')" accept="image/*"><div id="prev-depanProses"></div></div><div class="foto-slot">After: <input type="file" onchange="handleFatPhoto(event,'depanAfter')" accept="image/*"><div id="prev-depanAfter"></div></div></div><div class="foto-section"><h3>Tampak Dalam FAT</h3><div class="foto-slot">Before: <input type="file" onchange="handleFatPhoto(event,'dalamBefore')" accept="image/*"><div id="prev-dalamBefore"></div></div><div class="foto-slot">Proses: <input type="file" onchange="handleFatPhoto(event,'dalamProses')" accept="image/*"><div id="prev-dalamProses"></div></div><div class="foto-slot">After: <input type="file" onchange="handleFatPhoto(event,'dalamAfter')" accept="image/*"><div id="prev-dalamAfter"></div></div></div></div><button onclick="submitFatData()">Submit</button><div class="loading" id="submitLoading">Menyimpan data...</div>`;
      } else {
        // ===== FORM DW (Dropwire) =====
        // DW menggunakan multi-file upload (max 5 foto)
        document.getElementById('formPage').innerHTML = `<h2>${type} → Input Data</h2><label>Order ID</label><input type="text" id="orderId" placeholder="Masukkan Order ID" /><label>Nama Teknisi</label><input type="text" id="namaTeknisi" placeholder="Nama teknisi" /><div id="materialContainer"><label>Material</label><div class="material-row"><select>${materialOptions}</select><input type="text" placeholder="Qty / Keterangan" /><button onclick="removeMaterial(this)">x</button></div></div><button type="button" onclick="addMaterial()">+ Tambah Material</button><hr style="margin: 20px 0;"><input type="file" id="foto" multiple onchange="previewFiles()" accept="image/*" /><div id="preview" class="preview"></div><p id="fotoCount"></p><button onclick="submitData()">Submit</button><div class="loading" id="submitLoading">Menyimpan data...</div>`;
      }
    }

    // Fungsi untuk handle upload foto FAT (10 foto terstruktur)
    function handleFatPhoto(event, key) {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = e => {
          // Simpan foto ke object fatPhotos dengan key tertentu
          fatPhotos[key] = e.target.result; // Base64 encoded
          // Tampilkan preview
          document.getElementById('prev-' + key).innerHTML = `<img src="${e.target.result}" style="width:150px; height:100px; object-fit:cover;">`;
        };
        reader.readAsDataURL(file); // Convert ke base64
      }
    }

    // Fungsi untuk submit data FAT
    async function submitFatData() {
      const orderId = document.getElementById('FATName').value;
      const namaTeknisi = document.getElementById('namaTeknisi').value;
      
      // Daftar key foto yang wajib diisi (10 foto)
      const requiredKeys = ['redamanInBefore','redamanInAfter','redamanOutBefore','redamanOutAfter','depanBefore','depanProses','depanAfter','dalamBefore','dalamProses','dalamAfter'];
      
      // Validasi input wajib
      if (!orderId || !namaTeknisi) {
        alert("FAT Name dan Nama Teknisi wajib diisi!");
        return;
      }
      
      // Validasi semua foto wajib diisi
      for (let k of requiredKeys) {
        if (!fatPhotos[k]) {
          alert("Semua foto wajib diisi (10 foto)!");
          return;
        }
      }
      
      const loading = document.getElementById('submitLoading');
      loading.classList.add('active');
      
      // Buat object entry untuk dikirim ke API
      const entry = {
        orderId,
        type: currentType,
        namaTeknisi,
        materials: getMaterials(), // Ambil list material
        fotoCount: 10, // FAT selalu 10 foto
        fatPhotos, // Object berisi 10 foto base64
        createdBy: currentUser.username // Track siapa yang input
      };
      
      try {
        // Kirim data ke API
        const response = await fetch(`${API_URL}/orders`, {
          method: 'POST',
          headers: getAuthHeaders(),
          body: JSON.stringify(entry)
        });
        
        const data = await response.json();
        loading.classList.remove('active');
        
        if (data.success) {
          alert(`Data FAT "${orderId}" berhasil disimpan!`);
          await loadOrders(); // Reload data
          openForm(currentType); // Reset form
        } else {
          alert('Error: ' + (data.message || 'Unknown error'));
        }
      } catch (error) {
        loading.classList.remove('active');
        alert('Error: ' + error.message);
      }
    }

    // Fungsi untuk menambah baris material baru
    function addMaterial() {
      const container = document.getElementById('materialContainer');
      const options = getMaterialOptions(currentType);
      const row = document.createElement("div");
      row.className = "material-row";
      row.innerHTML = `<select>${options}</select><input type="text" placeholder="Qty / Keterangan" /><button onclick="removeMaterial(this)">x</button>`;
      container.appendChild(row);
    }

    // Fungsi untuk menghapus baris material
    function removeMaterial(btn) { 
      btn.parentElement.remove(); 
    }

    // Fungsi untuk mengambil semua data material dari form
    function getMaterials() {
      const materials = [];
      document.querySelectorAll('#materialContainer .material-row').forEach(row => {
        const mat = row.querySelector("select").value;
        const qty = row.querySelector("input").value;
        // Format: "Nama Material (Qty)"
        if (mat) materials.push(mat + (qty ? " ("+qty+")" : ""));
      });
      return materials;
    }

    // Fungsi untuk preview file DW (multiple upload max 5)
    function previewFiles() {
      const files = Array.from(document.getElementById("foto").files);
      
      // Validasi maksimal 5 foto (untuk menghindari size limit Firestore 1MB)
      if (files.length > 5) {
        alert("Maksimal 5 foto! (Firestore limit 1MB per dokumen)");
        document.getElementById("foto").value = '';
        return;
      }
      
      // Tambahkan file baru ke selectedFiles
      selectedFiles = selectedFiles.concat(files.map(file => ({ file, caption: "" })));
      renderPreview();
      document.getElementById("fotoCount").innerText = `Total foto: ${selectedFiles.length}`;
    }

    // Fungsi untuk render preview foto yang sudah dipilih
    function renderPreview() {
      const preview = document.getElementById("preview");
      preview.innerHTML = "";
      
      selectedFiles.forEach((item, index) => {
        const reader = new FileReader();
        reader.onload = e => {
          // Buat container preview
          const container = document.createElement("div");
          container.className = "preview-item";
          
          // Image preview
          const img = document.createElement("img");
          img.src = e.target.result;
          
          // Input untuk caption/keterangan
          const input = document.createElement("input");
          input.type = "text";
          input.placeholder = "Keterangan";
          input.value = item.caption || "";
          input.oninput = ev => selectedFiles[index].caption = ev.target.value;
          
          container.appendChild(img);
          container.appendChild(input);
          preview.appendChild(container);
        };
        reader.readAsDataURL(item.file);
      });
    }
    
    // Fungsi untuk submit data DW
    async function submitData() {
      const orderId = document.getElementById('orderId').value;
      const namaTeknisi = document.getElementById('namaTeknisi').value;
      const materials = getMaterials();
      
      // Validasi semua field wajib diisi
      if (!orderId || !namaTeknisi || materials.length === 0) {
        alert("Lengkapi semua field sebelum submit!");
        return;
      }
      
      const loading = document.getElementById('submitLoading');
      loading.classList.add('active');
      
      // Buat object entry
      const entry = {
        type: currentType,
        orderId,
        namaTeknisi,
        materials,
        fotoCount: selectedFiles.length,
        fotoData: [], // Array untuk menyimpan foto + caption
        createdBy: currentUser.username
      };
      
      // Convert semua file ke base64
      for (let i = 0; i < selectedFiles.length; i++) {
        const reader = new FileReader();
        await new Promise((resolve) => {
          reader.onload = (e) => {
            entry.fotoData.push({ 
              src: e.target.result, // Base64 encoded image
              caption: selectedFiles[i].caption 
            });
            resolve();
          };
          reader.readAsDataURL(selectedFiles[i].file);
        });
      }
      
      try {
        // Kirim data ke API
        const response = await fetch(`${API_URL}/orders`, {
          method: 'POST',
          headers: getAuthHeaders(),
          body: JSON.stringify(entry)
        });
        
        const data = await response.json();
        loading.classList.remove('active');
        
        if (data.success) {
          alert(`Data DW "${orderId}" berhasil disimpan!`);
          await loadOrders();
          openForm(currentType); // Reset form
        } else {
          alert('Error: ' + (data.message || 'Unknown error'));
        }
      } catch (error) {
        loading.classList.remove('active');
        alert('Error: ' + error.message);
      }
    }

    // ==================== RESUME/VIEW DATA ====================
    
    // Fungsi untuk menampilkan halaman resume (daftar semua orders)
    async function showResume() {
      // Sembunyikan halaman lain
      document.getElementById('formPage').style.display = "none";
      document.getElementById('resumePage').style.display = "block";
      document.getElementById('addAccountPage').style.display = "none";
      
      // Reload data terbaru dari database
      await loadOrders();
      
      // Tampilkan notice jika user bukan admin (read-only)
      let readOnlyNotice = '';
      if (!isAdmin()) {
        readOnlyNotice = '<div class="readonly-notice">Anda login sebagai User biasa. Anda hanya dapat melihat data tanpa bisa mengubah atau menghapus.</div>';
      }
      
      // Generate table rows dari resumeData
      let rows = resumeData.map((item) => {
// Edit & Delete button hanya muncul untuk admin
        const editBtn = isAdmin() ? `<button onclick="editOrder('${item.id}')">Edit</button>` : '';
        const deleteBtn = isAdmin() ? `<button onclick="deleteOrder('${item.id}')" style="background:#dc3545;">Hapus</button>` : '';
        
        return `<tr>
        <td>${item.orderId}</td>
        <td>${item.namaTeknisi}</td>
        <td>${item.type}</td>
        <td>${item.materials.join(", ")}</td>
        <td>${item.fotoCount}</td>
        <td class='actions'>
          <button onclick="viewDetail('${item.id}')">View</button>
          <button onclick="window.location='${API_URL}/download-pdf/${item.id}'">Download PDF</button>
          ${editBtn}${deleteBtn}
        </td>
      </tr>`;
      }).join("");
      
      // Jika tidak ada data
      if (!rows) rows = "<tr><td colspan='6'>Belum ada data</td></tr>";
      
      // Render halaman resume dengan tabel
      document.getElementById('resumePage').innerHTML = `<h2>Resume</h2>${readOnlyNotice}<input type="text" placeholder="Search by Order ID" oninput="filterResume(this.value)" /><table><thead><tr><th>Order ID</th><th>Nama Teknisi</th><th>Tipe</th><th>Material</th><th>Jumlah Foto</th><th>Aksi</th></tr></thead><tbody>${rows}</tbody></table>`;
    }

    // Fungsi untuk filter/search data resume berdasarkan Order ID
    function filterResume(query) {
      const tableBody = document.querySelector("#resumePage tbody");
      query = query.toLowerCase();
      
      // Filter data berdasarkan query
      const filtered = resumeData.filter(item => item.orderId.toLowerCase().includes(query));
      
      // Generate rows untuk data yang terfilter
      let rows = filtered.map((item) => {
        const editBtn = isAdmin() ? `<button onclick="editOrder('${item.id}')">Edit</button>` : '';
        const deleteBtn = isAdmin() ? `<button onclick="deleteOrder('${item.id}')" style="background:#dc3545;">Hapus</button>` : '';
        
        return `<tr><td>${item.orderId}</td><td>${item.namaTeknisi}</td><td>${item.type}</td><td>${item.materials.join(", ")}</td><td>${item.fotoCount}</td><td class='actions'>
        <button onclick="viewDetail('${item.id}')">View</button>
        <button onclick="window.location='${API_URL}/download-pdf/${item.id}'">Download PDF</button>
  ${editBtn}${deleteBtn}
</td>
</tr>`;
      }).join("");
      
      // Jika tidak ada hasil
      if (!rows) rows = "<tr><td colspan='6'>Data tidak ditemukan</td></tr>";
      tableBody.innerHTML = rows;
    }

    // Fungsi untuk melihat detail order dalam modal popup
    async function viewDetail(docId) {
      try {
        // Fetch detail order dari API
        const response = await fetch(`${API_URL}/orders/${docId}`);
        const data = await response.json();
        
        if (!data.success) {
          alert('Error: ' + data.message);
          return;
        }
        
        const item = data.order;
        const materialOptions = getMaterialOptions(item.type);
        
        // Generate HTML untuk material rows (disabled/read-only)
        let materialRowsHtml = '';
        item.materials.forEach(materialString => {
          let name = materialString, qty = "";
          // Parse format "Nama (Qty)" jika ada
          const match = materialString.match(/(.*) \((.*)\)$/);
          if (match) { 
            name = match[1]; 
            qty = match[2]; 
          }
          // Material ditampilkan dalam mode disabled (tidak bisa diedit di modal)
          materialRowsHtml += `<div class="material-row"><select disabled>${materialOptions}</select><input type="text" placeholder="Qty / Keterangan" value="${qty}" disabled/></div>`;
        });
        
        // Build HTML untuk modal
        let html = `<h3>Detail Order ${item.orderId}</h3><p><b>Nama Teknisi:</b> ${item.namaTeknisi}</p><p><b>Tipe:</b> ${item.type}</p><p><b>Materials:</b></p><div id="modalMaterialContainer">${materialRowsHtml}</div><hr style="margin: 20px 0;"><p><b>Jumlah Foto:</b> ${item.fotoCount}</p>`;
        
        // Jika tipe DW, tampilkan foto evidence dengan caption
        if (item.fotoData && item.fotoData.length > 0) {
          html += `<div><b>Foto Evidence:</b><div class='foto-grid'>`;
          item.fotoData.forEach((f) => {
            // Foto bisa diklik untuk preview fullscreen
            html += `<div class='foto-item'><img src="${f.src}" alt="Foto Evidence" onclick="showImagePreview(this.src)"> <small>${f.caption}</small></div>`;
          });
          html += `</div></div>`;
        }
        
        // Jika tipe FAT, tampilkan 10 foto terstruktur
        if (item.type === "FAT" && item.fatPhotos) {
          // Mapping label untuk setiap key foto FAT
          const fatLabels = {
            redamanInBefore: "Redaman IN - Before",
            redamanInAfter: "Redaman IN - After",
            redamanOutBefore: "Redaman OUT - Before",
            redamanOutAfter: "Redaman OUT - After",
            depanBefore: "Tampak Depan FAT - Before",
            depanProses: "Tampak Depan FAT - Proses",
            depanAfter: "Tampak Depan FAT - After",
            dalamBefore: "Tampak Dalam FAT - Before",
            dalamProses: "Tampak Dalam FAT - Proses",
            dalamAfter: "Tampak Dalam FAT - After"
          };
          html += `<div><b>Foto FAT Evidence:</b><div class='foto-grid'>`;
          
          // Loop semua foto FAT
          Object.entries(fatLabels).forEach(([key, label]) => {
            if (item.fatPhotos[key]) {
              html += `<div class='foto-item'><img src="${item.fatPhotos[key]}" alt="${label}" onclick="showImagePreview(this.src)"> <small>${label}</small></div>`;
            }
          });
          html += `</div></div>`;
        }
        
        // Tampilkan modal dengan konten detail
        document.getElementById('modalBody').innerHTML = html;
        document.getElementById('modal').style.display = 'flex';
        
        // Set value select untuk material setelah DOM ready
        setTimeout(() => {
          document.querySelectorAll('#modalMaterialContainer .material-row').forEach((row, materialIndex) => {
            const materialString = item.materials[materialIndex];
            let name = materialString;
            const match = materialString.match(/(.*) \((.*)\)$/);
            if (match) { name = match[1]; }
            row.querySelector('select').value = name;
          });
        }, 0);
        
      } catch (error) {
        alert('Error: ' + error.message);
      }
    }

    // Fungsi untuk menutup modal
    function closeModal() {
      document.getElementById("modal").style.display = "none";
    }

    // ==================== ACCOUNT MANAGEMENT (ADMIN ONLY) ====================
    
    // Fungsi untuk menampilkan halaman manajemen akun
    async function showAddAccount() {
      // Cek authorization - hanya admin
      if (!isAdmin()) {
        alert('Akses ditolak! Hanya Admin yang dapat mengelola akun.');
        return;
      }
      
      // Tampilkan halaman add account
      document.getElementById('formPage').style.display = "none";
      document.getElementById('resumePage').style.display = "none";
      document.getElementById('addAccountPage').style.display = "block";
      
      // Tampilkan loading sementara fetch data
      document.getElementById('addAccountPage').innerHTML = `<h2>Manajemen Akun</h2><div class="loading active">Memuat data...</div>`;
      
      try {
        // Fetch daftar user dari API
        const response = await fetch(`${API_URL}/users`);
        const data = await response.json();
        
        if (!data.success) {
          throw new Error(data.message || 'Failed to load users');
        }
        
        // Generate table rows untuk daftar user
        let userRows = data.users.map((user) => {
          return `<tr>
            <td>${user.username}</td>
            <td>••••••••</td>
            <td>${user.role === 'admin' ? 'Admin' : 'User'}</td>
            <td class='actions'>
              <button onclick="deleteUser('${user.id}', '${user.role}')" ${user.role === 'admin' ? 'disabled' : ''}>Hapus</button>
            </td>
          </tr>`;
        }).join("");
        
        // Render halaman manajemen akun
        document.getElementById('addAccountPage').innerHTML = `
          <h2>Manajemen Akun</h2>
          <div style="background: #f0f0f0; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
            <h3>Tambah Akun Baru</h3>
            <label>Username</label>
            <input type="text" id="newUsername" placeholder="Masukkan username baru" />
            <label>Password</label>
            <input type="password" id="newPassword" placeholder="Masukkan password" />
            <label>Role</label>
            <select id="newRole">
              <option value="user">User</option>
              <option value="admin">Admin</option>
            </select>
            <button onclick="addNewAccount()" style="margin-top: 10px;">Tambah Akun</button>
            <p id="addAccountMessage" style="margin-top: 10px; display: none;"></p>
          </div>
          <h3>Daftar Akun</h3>
          <table>
            <thead>
              <tr>
                <th>Username</th>
                <th>Password</th>
                <th>Role</th>
                <th>Aksi</th>
              </tr>
            </thead>
            <tbody>${userRows}</tbody>
          </table>
        `;
      } catch (error) {
        console.error('Error loading users:', error);
        // Tampilkan error message jika gagal load
        document.getElementById('addAccountPage').innerHTML = `
          <h2>Manajemen Akun</h2>
          <p style="color: red;">Error: ${error.message}</p>
          <p>Pastikan Flask server berjalan di http://localhost:5000</p>
          <button onclick="showAddAccount()">Coba Lagi</button>
        `;
      }
    }

    // Fungsi untuk menambah akun baru
    async function addNewAccount() {
      // Ambil value dari form
      const username = document.getElementById('newUsername').value.trim();
      const password = document.getElementById('newPassword').value.trim();
      const role = document.getElementById('newRole').value;
      const message = document.getElementById('addAccountMessage');
      
      // Validasi input tidak boleh kosong
      if (!username || !password) {
        message.style.color = 'red';
        message.innerText = 'Username dan password harus diisi!';
        message.style.display = 'block';
        return;
      }
      
      try {
        // Kirim request tambah user ke API
        const response = await fetch(`${API_URL}/users`, {
          method: 'POST',
          headers: getAuthHeaders(),
          body: JSON.stringify({ username, password, role })
        });
        
        const data = await response.json();
        
        if (data.success) {
          // Success - tampilkan pesan sukses
          message.style.color = 'green';
          message.innerText = `Akun "${username}" berhasil ditambahkan!`;
          message.style.display = 'block';
          
          // Reset form
          document.getElementById('newUsername').value = '';
          document.getElementById('newPassword').value = '';
          document.getElementById('newRole').value = 'user';
          
          // Reload halaman setelah 1.5 detik
          setTimeout(() => { showAddAccount(); }, 1500);
        } else {
          // Gagal - tampilkan error
          message.style.color = 'red';
          message.innerText = data.message || 'Gagal menambahkan akun';
          message.style.display = 'block';
        }
      } catch (error) {
        message.style.color = 'red';
        message.innerText = 'Error: ' + error.message;
        message.style.display = 'block';
      }
    }

    // Fungsi untuk menghapus user
    async function deleteUser(userId, role) {
      // Proteksi: admin tidak bisa dihapus
      if (role === 'admin') {
        alert('Akun admin tidak dapat dihapus!');
        return;
      }
      
      // Konfirmasi sebelum hapus
      if (!confirm('Hapus akun ini?')) {
        return;
      }
      
      try {
        // Kirim request delete ke API
        const response = await fetch(`${API_URL}/users/${userId}`, {
          method: 'DELETE',
          headers: getAuthHeaders()
        });
        
        const data = await response.json();
        
        if (data.success) {
          alert('Akun berhasil dihapus!');
          showAddAccount(); // Reload halaman
        } else {
          alert('Error: ' + (data.message || 'Unknown error'));
        }
      } catch (error) {
        alert('Error: ' + error.message);
      }
    }

    // ==================== IMAGE PREVIEW ====================
    
    // Fungsi untuk menampilkan gambar fullscreen
    function showImagePreview(src) {
      document.getElementById('fullSizeImage').src = src;
      document.getElementById('imagePreviewModal').style.display = 'flex';
    }

    // Fungsi untuk menutup image preview
    function closeImagePreview() {
      document.getElementById('imagePreviewModal').style.display = 'none';
    }

    // ==================== EDIT FUNCTIONS ====================
    
    // Fungsi untuk mengedit order yang sudah ada
    async function editOrder(docId) {
      // Cek authorization - hanya admin yang bisa edit
      if (!isAdmin()) {
        alert('Akses ditolak! Hanya Admin yang dapat mengedit data.');
        return;
      }
      
      try {
        // Fetch data order yang akan diedit
        const response = await fetch(`${API_URL}/orders/${docId}`);
        const data = await response.json();
        
        if (!data.success) {
          alert('Error: ' + data.message);
          return;
        }
        
        const item = data.order;
        currentType = item.type;
        
        // Tampilkan form edit
        document.getElementById('formPage').style.display = "block";
        document.getElementById('resumePage').style.display = "none";
        document.getElementById('addAccountPage').style.display = "none";
        
        const materialOptions = getMaterialOptions(item.type);
        
        if (item.type === "FAT") {
          // ===== EDIT FORM FAT =====
          document.getElementById('formPage').innerHTML = `<h2>Edit ${item.type} - ${item.orderId}</h2><label>FAT Name</label><input type="text" id="FATName" value="${item.orderId}" /><label>Nama Teknisi</label><input type="text" id="namaTeknisi" value="${item.namaTeknisi}" /><div id="materialContainer"><label>Material</label></div><button type="button" onclick="addMaterial()">+ Tambah Material</button><hr style="margin: 20px 0;"><div class="foto-pair"><div class="foto-section"><h3>Redaman In</h3><div class="foto-slot">Before: <input type="file" onchange="handleFatPhoto(event,'redamanInBefore')" accept="image/*"><div id="prev-redamanInBefore"></div></div><div class="foto-slot">After: <input type="file" onchange="handleFatPhoto(event,'redamanInAfter')" accept="image/*"><div id="prev-redamanInAfter"></div></div></div><div class="foto-section"><h3>Redaman Out</h3><div class="foto-slot">Before: <input type="file" onchange="handleFatPhoto(event,'redamanOutBefore')" accept="image/*"><div id="prev-redamanOutBefore"></div></div><div class="foto-slot">After: <input type="file" onchange="handleFatPhoto(event,'redamanOutAfter')" accept="image/*"><div id="prev-redamanOutAfter"></div></div></div></div><div class="foto-pair"><div class="foto-section"><h3>Tampak Depan FAT</h3><div class="foto-slot">Before: <input type="file" onchange="handleFatPhoto(event,'depanBefore')" accept="image/*"><div id="prev-depanBefore"></div></div><div class="foto-slot">Proses: <input type="file" onchange="handleFatPhoto(event,'depanProses')" accept="image/*"><div id="prev-depanProses"></div></div><div class="foto-slot">After: <input type="file" onchange="handleFatPhoto(event,'depanAfter')" accept="image/*"><div id="prev-depanAfter"></div></div></div><div class="foto-section"><h3>Tampak Dalam FAT</h3><div class="foto-slot">Before: <input type="file" onchange="handleFatPhoto(event,'dalamBefore')" accept="image/*"><div id="prev-dalamBefore"></div></div><div class="foto-slot">Proses: <input type="file" onchange="handleFatPhoto(event,'dalamProses')" accept="image/*"><div id="prev-dalamProses"></div></div><div class="foto-slot">After: <input type="file" onchange="handleFatPhoto(event,'dalamAfter')" accept="image/*"><div id="prev-dalamAfter"></div></div></div></div><button onclick="updateFatData('${docId}')">Update</button><button onclick="showResume()" style="background:#6c757d; margin-left:10px;">Batal</button><div class="loading" id="submitLoading">Menyimpan data...</div>`;
          
          // Populate material rows dari data yang ada
          item.materials.forEach(materialString => {
            let name = materialString, qty = "";
            const match = materialString.match(/(.*) \((.*)\)$/);
            if (match) { 
              name = match[1]; 
              qty = match[2]; 
            }
            
            const container = document.getElementById('materialContainer');
            const row = document.createElement("div");
            row.className = "material-row";
            row.innerHTML = `<select>${materialOptions}</select><input type="text" placeholder="Qty / Keterangan" value="${qty}" /><button onclick="removeMaterial(this)">x</button>`;
            container.appendChild(row);
            row.querySelector("select").value = name;
          });
          
          // Load existing fatPhotos dan tampilkan preview
          fatPhotos = item.fatPhotos || {};
          Object.keys(fatPhotos).forEach(key => {
            if (fatPhotos[key]) {
              document.getElementById('prev-' + key).innerHTML = `<img src="${fatPhotos[key]}" style="width:150px; height:100px; object-fit:cover;">`;
            }
          });
          
        } else {
          // ===== EDIT FORM DW =====
          document.getElementById('formPage').innerHTML = `<h2>Edit ${item.type} - ${item.orderId}</h2><label>Order ID</label><input type="text" id="orderId" value="${item.orderId}" /><label>Nama Teknisi</label><input type="text" id="namaTeknisi" value="${item.namaTeknisi}" /><div id="materialContainer"><label>Material</label></div><button type="button" onclick="addMaterial()">+ Tambah Material</button><hr style="margin: 20px 0;"><label>Foto Evidence Lama:</label><div id="existingPhotos" class="preview"></div><input type="file" id="foto" multiple onchange="previewFiles()" accept="image/*" /><div id="preview" class="preview"></div><p id="fotoCount"></p><button onclick="updateData('${docId}')">Update</button><button onclick="showResume()" style="background:#6c757d; margin-left:10px;">Batal</button><div class="loading" id="submitLoading">Menyimpan data...</div>`;
          
          // Populate material rows
          item.materials.forEach(materialString => {
            let name = materialString, qty = "";
            const match = materialString.match(/(.*) \((.*)\)$/);
            if (match) { 
              name = match[1]; 
              qty = match[2]; 
            }
            
            const container = document.getElementById('materialContainer');
            const row = document.createElement("div");
            row.className = "material-row";
            row.innerHTML = `<select>${materialOptions}</select><input type="text" placeholder="Qty / Keterangan" value="${qty}" /><button onclick="removeMaterial(this)">x</button>`;
            container.appendChild(row);
            row.querySelector("select").value = name;
          });
          
          // Tampilkan existing photos dengan opsi hapus
          const existingPhotos = document.getElementById('existingPhotos');
          if (item.fotoData && item.fotoData.length > 0) {
            item.fotoData.forEach((f, index) => {
              const container = document.createElement("div");
              container.className = "preview-item";
              
              // Image
              const img = document.createElement("img");
              img.src = f.src;
              
              // Caption (editable)
              const input = document.createElement("input");
              input.type = "text";
              input.placeholder = "Keterangan";
              input.value = f.caption || "";
              input.id = `existing-caption-${index}`;
              
              // Button hapus foto
              const deleteBtn = document.createElement("button");
              deleteBtn.innerText = "Hapus";
              deleteBtn.style.marginTop = "5px";
              deleteBtn.style.background = "#dc3545";
              deleteBtn.onclick = () => container.remove(); // Hapus dari DOM
              
              container.appendChild(img);
              container.appendChild(input);
              container.appendChild(deleteBtn);
              existingPhotos.appendChild(container);
            });
          }
          
          // Reset selectedFiles untuk foto baru
          selectedFiles = [];
        }
        
      } catch (error) {
        alert('Error: ' + error.message);
      }
    }

    // Fungsi untuk update data DW
    async function updateData(docId) {
      const orderId = document.getElementById('orderId').value;
      const namaTeknisi = document.getElementById('namaTeknisi').value;
      const materials = getMaterials();
      
      // Validasi
      if (!orderId || !namaTeknisi || materials.length === 0) {
        alert("Lengkapi semua field sebelum update!");
        return;
      }
      
      const loading = document.getElementById('submitLoading');
      loading.classList.add('active');
      
      // Ambil existing photos yang tidak dihapus
      const existingPhotos = [];
      document.querySelectorAll('#existingPhotos .preview-item').forEach((item, index) => {
        const img = item.querySelector('img');
        const caption = item.querySelector('input').value;
        existingPhotos.push({ src: img.src, caption });
      });
      
      // Convert new photos ke base64
      const newPhotos = [];
      for (let i = 0; i < selectedFiles.length; i++) {
        const reader = new FileReader();
        await new Promise((resolve) => {
          reader.onload = (e) => {
            newPhotos.push({ src: e.target.result, caption: selectedFiles[i].caption });
            resolve();
          };
          reader.readAsDataURL(selectedFiles[i].file);
        });
      }
      
      // Gabungkan existing + new photos
      const allPhotos = [...existingPhotos, ...newPhotos];
      
      // Buat entry untuk update
      const entry = {
        type: currentType,
        orderId,
        namaTeknisi,
        materials,
        fotoCount: allPhotos.length,
        fotoData: allPhotos,
        createdBy: currentUser.username
      };
      
      try {
        // Kirim request update ke API
        const response = await fetch(`${API_URL}/orders/${docId}`, {
          method: 'PUT',
          headers: getAuthHeaders(),
          body: JSON.stringify(entry)
        });
        
        const data = await response.json();
        loading.classList.remove('active');
        
        if (data.success) {
          alert(`Data DW "${orderId}" berhasil diupdate!`);
          await loadOrders();
          showResume();
        } else {
          alert('Error: ' + (data.message || 'Unknown error'));
        }
      } catch (error) {
        loading.classList.remove('active');
        alert('Error: ' + error.message);
      }
    }

    // Fungsi untuk update data FAT
    async function updateFatData(docId) {
      const orderId = document.getElementById('FATName').value;
      const namaTeknisi = document.getElementById('namaTeknisi').value;
      const requiredKeys = ['redamanInBefore','redamanInAfter','redamanOutBefore','redamanOutAfter','depanBefore','depanProses','depanAfter','dalamBefore','dalamProses','dalamAfter'];
      
      // Validasi
      if (!orderId || !namaTeknisi) {
        alert("FAT Name dan Nama Teknisi wajib diisi!");
        return;
      }
      
      // Validasi semua foto harus ada
      for (let k of requiredKeys) {
        if (!fatPhotos[k]) {
          alert("Semua foto wajib diisi (10 foto)!");
          return;
        }
      }
      
      const loading = document.getElementById('submitLoading');
      loading.classList.add('active');
      
      // Buat entry untuk update
      const entry = {
        orderId,
        type: currentType,
        namaTeknisi,
        materials: getMaterials(),
        fotoCount: 10,
        fatPhotos,
        createdBy: currentUser.username
      };
      
      try {
        // Kirim request update ke API
        const response = await fetch(`${API_URL}/orders/${docId}`, {
          method: 'PUT',
          headers: getAuthHeaders(),
          body: JSON.stringify(entry)
        });
        
        const data = await response.json();
        loading.classList.remove('active');
        
        if (data.success) {
          alert(`Data FAT "${orderId}" berhasil diupdate!`);
          await loadOrders();
          showResume();
        } else {
          alert('Error: ' + (data.message || 'Unknown error'));
        }
      } catch (error) {
        loading.classList.remove('active');
        alert('Error: ' + error.message);
      }
    }

    // ==================== DELETE FUNCTION ====================
    
    // Fungsi untuk menghapus order
    async function deleteOrder(docId) {
      // Cek authorization - hanya admin yang bisa delete
      if (!isAdmin()) {
        alert('Akses ditolak! Hanya Admin yang dapat menghapus data.');
        return;
      }
      
      // Konfirmasi sebelum menghapus
      if (!confirm('Apakah Anda yakin ingin menghapus data ini?')) {
        return;
      }
      
      try {
        // Kirim request delete ke API
        const response = await fetch(`${API_URL}/orders/${docId}`, {
          method: 'DELETE',
          headers: getAuthHeaders()
        });
        
        const data = await response.json();
        
        if (data.success) {
          alert('Data berhasil dihapus!');
          await loadOrders(); // Reload data setelah delete
          showResume(); // Kembali ke halaman resume
        } else {
          alert('Error: ' + (data.message || 'Unknown error'));
        }
      } catch (error) {
        alert('Error: ' + error.message);
      }
    }

    // ==================== EVENT LISTENERS ====================
    
    // Event listener untuk menutup modal ketika klik di luar modal content
    window.onclick = function(event) {
      const modal = document.getElementById('modal');
      // Jika yang diklik adalah overlay modal (bukan content)
      if (event.target === modal) {
        closeModal();
      }
    }
    
  </script>
</body>
</html>        
